function Placemark(c,b){this.run(c,b)}
(function(c){Placemark.prototype.run=function(b,e){this.options={fid:null,pid:null,name:null,desc:null,url:null,symbol:null,position:null,visible:!0};this.options=e;this.placemarkItem='.ibs-placemark-item-name[rel="'+this.options.pid+'"]';this.placemarkImage='.ibs-placemark-item-image[rel="'+this.options.pid+'"]';this.setName=function(a){this.options.name=a;this.marker.setTitle(a);"Waypoint"===this.options.symbol?b.html.waypoint_list.find(this.placemarkItem).text(a):b.html.placemark_list.find(this.placemarkItem).text(a)};
this.setIcon=function(){this.marker.setMap(null);/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(this.options.url)?this.options.symbol=b.getSymbol(this.options.url):this.options.url=b.getUrlFromSymbol(this.options.symbol?this.options.symbol:"");this.marker.setIcon(b.getIcon(this.options.url));this.marker.setMap(b.googlemap);this.marker.setVisible(this.options.visible)};this.remove=function(){this.marker.unbind();this.marker.setMap(null);b.file.removePlacemark(this.options.pid)};
this.open=function(){b.file.openInfo(this)};this.edit=function(){this.placemarkDialog()};this.placemarkDialog=function(){var a=null,d=b.getCkeditorConfig();b.infowindow.close();"Waypoint"===this.options.symbol?(a=b.html.waypoint_dialog,a.find(".ibs-waypoint-dialog-name").val(this.options.name),a.find(".ibs-waypoint-dialog-fid").val(this.options.fid),a.find(".ibs-waypoint-dialog-pid").val(this.options.pid),a.find(".ibs-waypoint-dialog-desc").val(this.options.desc),a.dialog({autoOpen:!0,height:"auto",
width:600,modal:!0,zIndex:100,buttons:{Update:c.proxy(function(){this.setName(a.find(".ibs-waypoint-dialog-name").val());b.html.waypoint_list.find(this.placemarkItem).text(a.find(".ibs-waypoint-dialog-name").val());this.options.desc=a.find(".ibs-waypoint-dialog-desc").val();this.marker.setVisible(!0);a.dialog("close");b.file.setDirty(!0)},this),Close:function(){c(this).dialog("close")}},close:function(){a.find(".ibs-waypoint-dialog-desc").ckeditorGet().destroy();c(this).dialog("destroy")},open:function(){a.find(".ibs-waypoint-dialog-desc").ckeditor(d);
a.find(".ibs-waypoint-dialog-desc").ckeditor().resize("100%","100%",!1);a.find(".ibs-waypoint-dialog-desc").ckeditor().editor.mappro=b},resize:function(b){a.find(".ibs-waypoint-dialog-desc").ckeditor().resize("100%","100%",!1)}})):(a=b.html.placemark_dialog,a.find(".ibs-placemark-selected-icon").attr("src",this.options.url),a.find(".ibs-placemark-dialog-name").val(this.options.name),a.find(".ibs-placemark-dialog-fid").val(this.options.fid),a.find(".ibs-placemark-dialog-pid").val(this.options.pid),
a.find(".ibs-placemark-dialog-desc").val(this.options.desc),a.dialog({autoOpen:!0,height:"auto",width:600,modal:!0,buttons:{Update:c.proxy(function(){this.setName(a.find(".ibs-placemark-dialog-name").val());this.options.url=a.find(".ibs-placemark-selected-icon").attr("src");b.html.list.find(this.placemarkImage).attr({src:this.options.url});this.setIcon();this.options.desc=a.find(".ibs-placemark-dialog-desc").val();this.marker.setVisible(!0);a.dialog("close");b.file.setDirty(!0)},this),Close:function(){c(this).dialog("close")}},
close:function(){a.find(".ibs-placemark-dialog-desc").ckeditorGet().destroy();c(this).dialog("destroy")},open:function(){a.find(".ibs-placemark-dialog-desc").ckeditor(d);a.find(".ibs-placemark-dialog-desc").ckeditor().resize("100%","100%",!1);a.find(".ibs-placemark-dialog-desc").ckeditor().editor.mappro=b},resize:function(b){a.find(".ibs-placemark-dialog-desc").ckeditor().resize("100%","100%",!1)}}))};this.setPlacemarkItem=function(){var a=this.options.pid,d=c("<div>").html(this.options.desc).contents().filter(function(){return!!c.trim(this.innerHTML||
this.data)}).first(),d="<label>"+this.options.name+"</label><div>"+c(d).text().slice(0,300)+"</div>",a=c("<li>").addClass("ibs-placemark-item-"+a).append(c("<img>").addClass("ibs-placemark-item-image").css({height:"18px"}).attr({rel:a,alt:"image",src:this.marker.icon.url})).append(c("<a>").addClass("ibs-placemark-item-name name").attr({rel:a,href:"#",title:""}).html(d));"Waypoint"===this.options.symbol?b.html.waypoint_list.append(c(a)):b.html.placemark_list.append(c(a))};this.marker=new google.maps.Marker({position:this.options.position,
map:null,title:this.options.name,draggable:b.options.args.admin&&"Waypoint"!==this.options.symbol,zIndex:999,optimized:!1,placemark:this,visible:!1});this.setIcon();this.setPlacemarkItem();b.html.placemark_list.find(".ibs-placemark-item-image[pid="+this.options.pid+"]").attr("src",this.marker.icon.url);b.html.waypoint_list.find(".ibs-placemark-item-image[pid="+this.options.pid+"]").attr("src",this.marker.icon.url);google.maps.event.addListener(this.marker,"click",c.proxy(function(a){"Waypoint"===
this.options.symbol?b.html.waypoint_list.find(this.placemarkItem).trigger("click"):b.html.placemark_list.find(this.placemarkItem).trigger("click")},this));google.maps.event.addListener(this.marker,"dragend",c.proxy(function(a){this.options.position=this.marker.getPosition()},this));google.maps.event.addListener(this.marker,"mouseover",c.proxy(function(a){},this))}})(jQuery);
