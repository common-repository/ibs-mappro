function UploadLibraryDialog(a){this.run(a)}
(function(a){UploadLibraryDialog.prototype.run=function(b){var c=a('<div class="ibs-upload-dialog" >').attr("title","Upload Icons").hide().append(a('<div class="ibs-upload-browser" >')).append(a("<div>").append(a("<span>").append(a("<div>").addClass("ibs-section-header").html("Target")).append(a("<div>").append(a('<input class="ibs-upload-target-directory" >').attr({type:"text",size:"75",value:"/"}))))).append(a("<div>").append(a("<span>").append(a("<div>").addClass("ibs-section-header").css({"font-size":".9em","padding-left":"5px"}).html("status")).append(a("<div >").addClass("ibs-map-upload-div ibs-file-list-div").css("height",
"100px").append(a('<ul class="ibs-upload-list" >').addClass(" ibs-file-list")))).append(a("<div>").hide().append(a('<div class="ibs-upload-button" >').html("Browse")))),e=c.find(".ibs-upload-button").fineUploader({listElement:c.find(".ibs-upload-list"),request:{endpoint:b.url+"lib/server/endpoint.php",params:{dir:b.libpath}},debug:!1});e.on("complete","",{},function(a,b,c,l){});c.on("change",".ibs-upload-target-directory",{},function(a){var f=b.libpath;a=c.find(".ibs-upload-target-directory").val().replace(f,
"");-1===a.indexOf(f)&&(a=f+a);a===f&&(a=f+"new/");a=(a+"/").replace("//","/");f=a.replace(f,"");c.find(".ibs-upload-target-directory").val(f).focus();e.fineUploader("setParams",{dir:a})});c.dialog({autoOpen:!0,width:"auto",modal:!0,buttons:{"Select Files":a.proxy(function(){var a=c.find(".ibs-upload-button");a.find("input[qq-button-id]");a.find("input").trigger("click")},this),Clear:function(){c.find(".ibs-upload-list").empty()},Close:function(){c.dialog("close")}},close:function(){c.dialog("destroy")},
open:function(){var a=b.libpath+"icons/new/";c.find(".ibs-upload-target-directory").val("new/");e.fineUploader("setParams",{dir:a});c.find(".ibs-upload-browser").fileTree({root:b.libpath,script:b.ajax+"?action=ibs_mappro_index&func=folders&type=dir&nonce="+b.nonce,folderEvent:"click",expandSpeed:1E3,collapseSpeed:1E3,multiFolder:!1},function(a){alert(a)},function(a){c.find(".ibs-upload-target-directory").val(a);c.find(".ibs-upload-target-directory").trigger("change")})}})}})(jQuery);
function CleanLibraryDialog(a){this.run(a)}
(function(a){CleanLibraryDialog.prototype.run=function(b){console.log(b.libpath);var c=a('<div class="ibs-clean-dialog" >').attr("title","Manage Folders").hide().append(a('<div class="ibs-clean-browser" >')).append(a("<div>").append(a("<span>").append(a("<div>").addClass("ibs-section-header").html("Target")).append(a("<div>").append(a('<input class="ibs-clean-target-directory" >').attr({type:"text",size:"75",value:"/",disabled:!0})))));c.find(".ibs-clean-target-directory").val("");c.dialog({autoOpen:!0,
width:"auto",modal:!0,buttons:{"Remove Files":function(){var e="";c.find(".ibs-clean-browser").find("LI A.selected").each(function(b){e+=a(this).attr("rel")+";"});0<e.length&&a.get(b.ajax,{action:"ibs_mappro_index",func:"remove",nonce:b.nonce,type:"files",dir:b.libpath+c.find(".clean-target-directory").val(),files:e}).done(function(){c.find(".clean-browser").find("LI A.selected").remove()})},"Remove Folder":function(){a.get(b.ajax,{action:"ibs_mappro_index",func:"remove",nonce:b.nonce,type:"directory",
dir:b.libpath+c.find(".clean-target-directory").val()}).done(function(){c.find(".ibs-clean-browser").find("LI.expanded").remove();c.find(".ibs-clean-target-directory").val().replace("/","")})},Close:function(){c.dialog("close")}},close:function(){c.dialog("destroy")},open:function(){c.find(".ibs-clean-browser").fileTree({root:b.libpath,script:b.ajax+"?action=ibs_mappro_index&func=folders&type=all&nonce="+b.nonce,folderEvent:"click",expandSpeed:0,collapseSpeed:0,multiFolder:!1},function(a){},function(a){c.find(".ibs-clean-target-directory").val(a.replace(b.libpath,
""))})}})}})(jQuery);function BrowseImagesDialog(a,b,c){this.run(a,b,c)}
(function(a){BrowseImagesDialog.prototype.run=function(b,c,e){var d=a("<div>").addClass("ibs-browse-dialog").attr("title","Browse images").css({"z-index":"10050"}).hide().append(a("<div>").addClass("ibs-dialog-header").append(a("<div>").addClass("ibs-section-header").text("preview")).append(a("<div>").css({height:"200px",width:"400px",overflow:"hidden"}).addClass("ibs-image-html").append(a("<div>").addClass("ibs-image-frame").css({float:"left"}).append(a("<img>").attr({src:b.url+"image/BigBend.png"}).css({height:"200px",
width:"auto"}).addClass("ibs-image-preview")))).append(a("<div>").addClass("ibs-section-header").html("size").hide()).append(a("<div>").addClass("ibs-section-header").html("Image Libaray")).append(a("<div>").addClass("ibs-image-browser-div").css({height:"150px","overflow-y":"auto","overflow-x":"hidden"}).append(a("<div>").addClass("ibs-image-browser JQueryFTD")))).append(a("<div>").hide().append(a('<div class="ibs-upload-button" >').html("Browse")).append(a('<input class="ibs-upload-target-directory" >').attr({type:"text",
size:"75",value:"/"})).append(a('<ul class="ibs-upload-list" >').addClass(" ibs-file-list")));c="#"+a(c.mappro.options.args.div).attr("id");var f=d.find(".ibs-upload-button").fineUploader({listElement:d.find(".ibs-upload-list"),request:{endpoint:b.url+"lib/server/endpoint.php",params:{"multiples:false, dir":b.libpath+"images/"}},debug:!1});f.on("complete","",{},function(a,f,c,m){a=g.replace(b.libpath,b.liburl)+c;CKEDITOR.tools.callFunction(e,a);d.dialog("close")});var g=b.libpath+"images/";d.dialog({autoOpen:!0,
width:"auto",modal:!0,position:{my:"left top",at:"left top",of:c},buttons:{Upload:function(){var a=d.find(".ibs-upload-button");a.find("input[qq-button-id]");a.find("input").trigger("click")},Insert:function(){var a=d.find(".ibs-image-preview").attr("src");CKEDITOR.tools.callFunction(e,a);d.dialog("close")},Close:function(){a(this).dialog("close")}},close:function(){a(this).dialog("destroy")},open:function(){a(".ibs-browse-dialog").css({position:"relative"});d.find(".ibs-image-browser").fileTree({root:b.libpath+
"images/",script:b.ajax+"?action=ibs_mappro_index&func=folders&type=img&nonce="+b.nonce,folderEvent:"click",expandSpeed:0,collapseSpeed:0,multiFolder:!1},function(f){d.find(".ibs-image-browser").find("LI A.selected").each(function(c){f!==a(this).attr("rel")?a(this).removeClass("selected"):(url=a(this).attr("rel").replace(b.libpath,b.liburl),d.find(".ibs-image-preview").attr("src",url))})},function(a){var d=b.libpath+"images/";a=a.replace(d,"");-1===a.indexOf(d)&&(a=d+a);a===d&&(a=d+"images/");g=a=
(a+"/").replace("//","/");f.fineUploader("setParams",{dir:a})});d.find(".ibs-image-browser").on("mouseover","li.file a",{},function(f){f=a(this).attr("rel").replace(b.libpath,b.liburl);d.find(".ibs-image-preview").attr("src",f)});d.find(".ibs-image-browser").on("mouseout","li.file a",{},function(f){f=d.find("a.selected").first();f.length?(url=a(f).attr("rel").replace(b.libpath,b.liburl),d.find(".ibs-image-preview").attr("src",url)):d.find(".ibs-image-preview").attr("src",b.url+"image/BigBend.png")})}})}})(jQuery);
function IconLibraryDialog(a){this.run(a)}
(function(a){IconLibraryDialog.prototype.run=function(b){function c(){a("#target-select").empty();a("#source-select").empty();a("#target-select").append(a("<option>").attr({value:""}).text("")).append(a("<option>").attr({value:"%new%"}).text("new folder").prop("selected",!0));a("#source-select").append(a("<option>").attr({value:""}).text(""));a.getJSON(b.ajax,{action:"ibs_mappro_index",func:"dirs",dir:b.libpath+"icons/",nonce:b.nonce}).done(function(b,d){for(var c in b)a("#target-select").append(a("<option>").attr({value:b[c]}).text(b[c])),a("#source-select").append(a("<option>").attr({value:b[c]}).text(b[c]))});
a("#target-select").trigger("change");a("#source-select").trigger("change")}function e(b,d){var c=getFilename(b),c=a("<input>").addClass("target-file-name").attr({type:"text",value:c}),e="background:url(%url) left top no-repeat; vertical-align:middle;".replace(/%url/,b),e=a("<li>").addClass("target-file-item").attr({style:e}).addClass(d).append(a("<div>").append(c).append(a("<a>").addClass("icon-delete").text(" ").attr({href:"#",title:"delete"}))).append(a("<input>").addClass("target-file-url").attr({type:"hidden",
value:b}));"library"===d?a("#target-file-list").append(a(e)):a("#target-file-list").prepend(a(e));a(c).droppable({accept:".map-icon",addClasses:!1,hoverClass:"ui-state-hover",drop:function(b,d){var c=d.draggable.attr("src");a(this).val(getFilename(c));var f=a(this).parents("li")[0],g=a(f).find(".target-file-url").val();a(f).find(".target-file-url").val(c).attr({rel:g});c="background:url(%url) left top no-repeat; vertical-align:middle;".replace(/%url/,d.draggable.attr("src"));a(f).attr("style",c).addClass("replace")}})}
var d=a('<div class="ibs-icon-dialog" >').attr("title","Icon Library").hide().append(a("<div>").css({height:"100%",float:"left"}).append(a("<label>").text("target ")).append(a("<select>").attr({id:"target-select"}).append(a("<option>").attr({value:""}).text("")).append(a("<option>").attr({value:"%new%"}).text("new folder").prop("selected",!0))).append(a("<div>").addClass("icon-add").attr({title:"add icon"}).append(a("<input>").attr({id:"icon-add-input",type:"text",placeholder:"drop icon here to add."}))).append(a("<ul>").attr({id:"target-file-list"}).addClass("icon-palette"))).append(a("<div>").css({height:"100%",
float:"left"}).append(a("<label>").text("source ")).append(a("<select>").attr({id:"source-select"}).append(a("<option>").attr({value:"",placeholder:"select souce libary"}))).append(a("<ul>").attr({id:"source-file-list"}).addClass("icon-palette"))).append(a("<div>").hide().append(a('<div class="ibs-upload-button" >').html("Browse")).append(a('<input class="ibs-upload-target-directory" >').attr({type:"text",size:"75",value:"/"})).append(a('<ul class="ibs-upload-list" >').addClass(" ibs-file-list")));
d.find(".ibs-upload-button").fineUploader({listElement:d.find(".ibs-upload-list"),request:{endpoint:b.url+"lib/server/endpoint.php",params:{multiples:!1,dir:b.libpath+"uploads/"}},debug:!1}).on("complete","",{},function(a,d,c,k){e(b.liburl+"uploads/"+c,"copy")});d.dialog({autoOpen:!0,width:650,height:810,resize:!1,modal:!0,buttons:{Upload:function(){var a=d.find(".ibs-upload-button");a.find("input[qq-button-id]");a.find("input").trigger("click")},Update:function(){function d(){var k=e.pop(),h={action:"ibs_mappro_index",
nonce:b.nonce};console.log(k);switch(k.func){case "remove":h.func="remove";h.type="file";h.filename=k.url.replace(b.liburl,b.libpath);break;case "replace":case "copy":h.func="copy";h.source=k.url.replace(b.liburl,b.libpath);if("undefined"==typeof k.org||""===k.org){var m=getExtension(k.url);h.target=b.libpath+"icons/"+g+"/"+k.name+"."+m}else h.target=k.org.replace(b.liburl,b.libpath);break;case "rename":h.func="rename",h.type="file",h.oldname=k.url.replace(b.liburl,b.libpath),m=getFilename(h.oldname),
h.newname=h.oldname.replace(m,k.name)}a.get(b.ajax,h).done(function(a,b){"success"===b&&-1===a.indexOf("error")?e.length?d():c():alert(a)})}var g=a("#target-select").val(),e=[];a("#target-file-list").find("li").each(function(b,d){var c=a(d).find("input.target-file-url").val(),f=a(d).find("input.target-file-url").attr("rel"),g=a(d).find("input.target-file-name").val(),c={func:"",url:c,org:f,name:g};a(d).hasClass("remove")?(c.func="remove",e.push(c)):a(d).hasClass("copy")&&!a(d).hasClass("replace")?
(c.func="copy",e.push(c)):a(d).hasClass("replace")?(c.func="replace",e.push(c)):a(d).hasClass("rename")&&(c.func="rename",e.push(c))});g=a("#target-select").val();"%new%"==g?(g=prompt("Enter new Icon folder name","custom"),""!==g&&(a("#target-select").val(g),d())):d()},Close:function(){d.dialog("close")}},close:function(){d.dialog("destroy")},open:function(){c()}});a("#target-select").on("change","",{},function(d){d=a("#target-select").val();a("#target-file-list").empty();""!==d&&"%new%"!==d&&a.getJSON(b.ajax,
{action:"ibs_mappro_index",func:"icons",lib:b.libpath+"icons/"+d,nonce:b.nonce,cache:!1}).done(function(a,b){for(var d in a)e(a[d].url,"library")})});a("#source-select").on("change","",{map:this},function(d){d=a("#source-select").val();a("#source-file-list").empty();""!==d&&(a(".map-icon").each(function(d,b){a(b).data("qtip")&&(a(b).qtip("destroy",!0),a(b).removeData("hasqtip"),a(b).removeAttr("data-hasqtip"))}),a.getJSON(b.ajax,{action:"ibs_mappro_index",func:"icons",lib:b.libpath+"icons/"+d,nonce:b.nonce}).done(function(b,
d){for(var c in b)a("#source-file-list").append('<img class="map-icon" src="'+b[c].url+'" title="'+b[c].name+'" width="32" height="32" />');a(".map-icon").qtip();a(".map-icon").draggable({revert:!0,activeClass:"ui-state-highlight"});a(".map-icon").on("click","",{},function(b){e(a(this).attr("src"),"copy")})}))});a("#icon-add-input").droppable({accept:".map-icon",addClasses:!1,hoverClass:"ui-state-hover",drop:function(a,b){var d=b.draggable.attr("src");e(d,"copy")}});a("#target-file-list").on("click",
".icon-delete",{},function(b){a(this).parents("li").eq(0).addClass("remove").hide()});a("#target-file-list").on("change",".target-file-name",{},function(b){a(this).parents("li").eq(0).addClass("rename")})}})(jQuery);function TracksDialog(a){this.run(a)}
(function(a){TracksDialog.prototype.run=function(b){var c=a("<div>").addClass("ibs-tracking-dialog").attr({title:"IBS Mappro Tracking"}).hide().append(a("<div>").addClass("ibs-dialog-header ibs-tracking-div").append(a("<div>").addClass("ibs-section-header").html("Marker names tracked")).append(a("<div>").addClass("ibs-tracking-select-div controls").append(a("<ul>").addClass("ibs-controls").attr({id:"tracking-list",title:"tracking marker list"}).css({"max-height":"300px","overflow-y":"auto","overflow-x":"hidden"}))).append(a("<div>").addClass("ibs-section-header").html("Track")).append(a("<div>").append(a("<label>").html("<span>id</span>").addClass("ibs-first")).append(a("<input>").addClass("tracking-edit").css({width:"350px"}).attr({id:"item-id",
name:"id",type:"text",value:"",title:"marker name",placeholder:"(required) marker name to track"}).prop("disabled",!0).css({"background-color":"lightgray"})).append(a("<a>").addClass("icon-delete").text(" ").attr({id:"delete-tracking",href:"#",title:"remove tracking"}))).append(a("<div>").append(a("<label>").text("date").addClass("ibs-first")).append(a("<input>").addClass("tracking-edit").css({width:"350px"}).attr({id:"item-date",name:"date",type:"text",value:"",title:"date last update",placeholder:"date of last update"}).prop("disabled",
!0).css({"background-color":"#cfd1cf"}))).append(a("<div>").append(a("<label>").html("<span>where</span>").addClass("ibs-first")).append(a("<input>").addClass("tracking-edit").css({width:"350px"}).attr({id:"item-where",name:"where",type:"text",value:"",title:"where marker is",placeholder:"(required) where marker is"}))).append(a("<div>").append(a("<div>").append(a("<label>").text("msg"))).append(a("<textarea>").addClass("tracking-edit").attr({id:"item-msg",name:"msg",cols:50,rows:3,value:"",title:"message",
placeholder:"(optional) marker message"}))).append(a("<div>").addClass("ibs-section-header").text("shortcode")).append(a("<textarea>").attr({id:"shortcode",cols:"50",rows:"3",name:"maps",wrap:"soft",title:"post shortcode",placeholder:"shortcode"}).addClass("ibs-tracking-result")));c.dialog({autoOpen:!0,modal:!0,width:"500",buttons:{Update:function(){var e=[];a(".tracking-item").each(function(b,c){""!==a(c).attr("name")&&"%new%"!==a(c).attr("name")&&e.push(JSON.parse(a(c).attr("data")))});(function(){var d=
{action:"ibs_mappro_index",nonce:b.options.args.nonce,func:"set_track",data:JSON.stringify(e)};a.get(b.options.args.ajax,d).done(function(a,d){"success"===d&&-1===a.indexOf("error")?(c.dialog("close"),b.file.tracking()):alert(a)})})()},Close:function(){c.dialog("close")},Cancel:function(){c.dialog("close")}},close:function(){c.dialog("destroy")},open:function(){var e=a("<li>").addClass("tracking-item new").attr({name:"%new%",data:JSON.stringify({id:"%new%",where:"",msg:"",date:""})}).text("new marker");
a("#tracking-list").append(e.clone());a.getJSON(b.options.args.ajax,{action:"ibs_mappro_index",func:"tracking",nonce:b.options.args.nonce}).done(function(b,c){for(var e in b)b[e].id=e,a("#tracking-list").append(a("<li>").addClass("tracking-item").attr({name:e,data:JSON.stringify(b[e])}).text(e))});a("#tracking-list").on("click",".tracking-item",{},function(){event.preventDefault();a(".tracking-item").removeClass("selected");a(this).addClass("selected");var b=a(this).attr("data"),b=JSON.parse(b);"object"===
typeof b&&(a("#item-id").val(b.id),a("#item-where").val(b.where),a("#item-msg").val(b.msg),a("#item-date").val(b.date),"%new%"===b.id?a("#item-id").val("").prop("disabled",!1).css({"background-color":"inherit"}):a("#item-id").prop("disabled",!0).css({"background-color":"#cfd1cf"}),b='[ibs-track  id="'+b.id+'" where="'+b.where+'" msg="'+b.msg+'"',a("#shortcode").val(b+"]"))});a(".tracking-edit").on("change","",{},function(){var b=a(this).attr("name"),f=a("li.tracking-item.selected"),g=JSON.parse(a(f).attr("data")),
l=a(this).val();switch(b){case "id":"%new%"===a(f).attr("name")&&""!==l&&(g=JSON.parse(a(f).attr("data")),g.id=l,a(f).attr({name:l}).text(l),a(this).prop("disabled",!0).css({"background-color":"silver"}),c.find("#tracking-list").prepend(e.clone()));break;case "where":g.where=l;break;case "msg":g.msg=l}g.action="update";a(f).attr({data:JSON.stringify(g)});b='[ibs-track id="'+g.id+'" where="'+g.where+'" msg="'+g.msg+'"';a("#shortcode").val(b+"]")});a("#delete-tracking").on("click","",{},function(b){b.preventDefault();
a("li.tracking-item.selected").remove();a(".tracking-item").first().trigger("click")})}});a("[title]").each(function(b,c){a(c).qtip({surpress:!0,position:{my:"top left",at:"bottom right"},style:{classes:"qtip-bootstrap falsefalse"},show:{event:"mouseover"},hide:{fixed:!0,delay:250,event:"mouseout mouseleave"}})})}})(jQuery);
